import{r as m,j as e}from"./react-CIdJ77ke.js";import{u as T,a as I,b as L,F as g,L as C,D as A,c as O}from"./index-CIRHoGv6.js";import{g as G,a as H,b as D,c as M}from"./githubService-CWGcmBke.js";import"./db-DoDjOlgE.js";import"./accessibilityService-CxnTg-sn.js";import"./workspaceConnectorService-DpOCHZ2y.js";import{c as U}from"./diff-CqM5-8zX.js";import"./@braintree-DzxiOROe.js";import"./react-dom-R9L8nDNe.js";import"./scheduler-CoSDG3-6.js";import"./@google-dIZ1hAme.js";import"./idb-Dob3nYDb.js";import"./marked-BrGMJkBT.js";import"./mermaid-BKUgZdUC.js";import"./dayjs-CeEF-NGT.js";import"./d3-transition-CiCB8KJE.js";import"./d3-timer-DdKHrDhs.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-interpolate-CtIaNujU.js";import"./d3-color-amxIadob.js";import"./d3-selection-C52G7wmG.js";import"./d3-ease-DRPgKoYJ.js";import"./d3-zoom-BYoC3mS3.js";import"./dompurify-J5RlrwSC.js";import"./dagre-d3-es-CTpFWynZ.js";import"./lodash-es-Dt6r0yiR.js";import"./d3-shape-CX8xTzfR.js";import"./d3-path-CimkQT29.js";import"./d3-fetch-BOsq7VnW.js";import"./khroma-DUX6PT6k.js";import"./uuid-DhYbOkY1.js";import"./d3-scale-DRZz3QW5.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-DGRYoJHh.js";import"./d3-format-CzD4bSOQ.js";import"./d3-time-format-CUNN4Ell.js";import"./d3-time-6cSPyVSY.js";import"./d3-axis-DSWTncID.js";import"./elkjs-oKFFZvz7.js";import"./cytoscape-DtBltrT8.js";import"./cytoscape-cose-bilkent-Cgr1thlj.js";import"./cose-base-CwCxnKwh.js";import"./layout-base-CMXQqlmj.js";import"./d3-sankey-DgqkLiUE.js";import"./d3-scale-chromatic-B-NsZVaP.js";import"./ts-dedent-DrFu-skq.js";import"./stylis-D5iaQeiq.js";import"./mdast-util-from-markdown-CLAsVoWb.js";import"./micromark-CTBPIv-_.js";import"./micromark-util-combine-extensions-Bka6Sc1c.js";import"./micromark-util-chunked-DrRIdSP-.js";import"./micromark-factory-space-x2vfxbz5.js";import"./micromark-util-character-Bcm1tP9o.js";import"./micromark-core-commonmark-AH8VCgT7.js";import"./micromark-util-classify-character-Cq7Fg3xE.js";import"./micromark-util-resolve-all-PQCKh0dx.js";import"./decode-named-character-reference-C3-224fz.js";import"./micromark-util-subtokenize-QwsxNXk2.js";import"./micromark-factory-destination-CypD_wgM.js";import"./micromark-factory-label-CRHH4ZHP.js";import"./micromark-factory-title-B7kCBvC9.js";import"./micromark-factory-whitespace-B322EA6O.js";import"./micromark-util-normalize-identifier-C9ANKk3v.js";import"./micromark-util-html-tag-name-DbKNfynz.js";import"./micromark-util-decode-numeric-character-reference-DRnCnno4.js";import"./micromark-util-decode-string-DJl8Y_PO.js";import"./unist-util-stringify-position-Ch_qCilz.js";import"./mdast-util-to-string-C_aolqmU.js";import"./jszip-CFFhfFtd.js";import"./octokit-B6bKu3NB.js";import"./@octokit-MBEWYTsi.js";import"./bottleneck-D_vuF9V7.js";import"./universal-user-agent-CLgqIJsR.js";import"./before-after-hook-y8XtM9xW.js";import"./fast-content-type-parse-3SwieiST.js";import"./axe-core-NFfJ1iTt.js";const _=({node:a,onFileSelect:d,activePath:u})=>{const[n,o]=m.useState(!0);if(a.type==="file"){const l=u===a.path;return e.jsxs("div",{className:`flex items-center space-x-2 pl-4 py-1 cursor-pointer rounded ${l?"bg-primary/10 text-primary":"hover:bg-gray-100 dark:hover:bg-slate-700"}`,onClick:()=>d(a.path,a.name),children:[e.jsx(A,{}),e.jsx("span",{children:a.name})]})}return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 py-1 cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-700 rounded",onClick:()=>o(!n),children:[e.jsx("div",{className:`transform transition-transform ${n?"rotate-90":""}`,children:"â–¶"}),e.jsx(g,{}),e.jsx("span",{className:"font-semibold",children:a.name})]}),n&&a.children&&e.jsx("div",{className:"pl-4 border-l border-border ml-3",children:a.children.map(l=>e.jsx(_,{node:l,onFileSelect:d,activePath:u},l.path))})]})},ct=()=>{const{state:a,dispatch:d}=T(),{user:u,githubUser:n,selectedRepo:o,projectFiles:l}=a,{addNotification:y}=I(),{octokit:s,reinitialize:N}=L(),[v,w]=m.useState([]),[x,c]=m.useState(null),[E,h]=m.useState(""),[i,b]=m.useState(null),f=m.useCallback(t=>{t.status===401?(d({type:"SET_GITHUB_USER",payload:null}),y("GitHub token is invalid or expired. Please update it in the Connections Hub.","error"),h("GitHub authentication failed. Please update your token.")):h(t instanceof Error?t.message:"An unexpected error occurred.")},[d,y]);m.useEffect(()=>{!s&&n&&N()},[s,n,N]),m.useEffect(()=>{(async()=>{if(u&&n&&s){c("repos"),h("");try{const r=await H(s);w(r)}catch(r){f(r)}finally{c(null)}}else w([])})()},[u,n,s,f]);const S=m.useCallback(async t=>{if(u&&n&&s){c("tree"),h(""),b(null);try{const r=await G(s,t.owner.login,t.name);d({type:"LOAD_PROJECT_FILES",payload:r})}catch(r){f(r)}finally{c(null)}}},[u,n,s,d,f]);m.useEffect(()=>{o&&s&&(!l||l.name!==o.repo)&&S({name:o.repo,full_name:o.full_name,owner:{login:o.owner}})},[o,l,s,S]);const R=async(t,r)=>{if(!(!o||!s)){c("file");try{const p=await D(s,o.owner,o.repo,t);b({path:t,name:r,originalContent:p,editedContent:p})}catch(p){f(p)}finally{c(null)}}},F=async()=>{if(!(!i||!o||!s||i.originalContent===i.editedContent)){c("commit"),h("");try{const t=U(i.path,i.originalContent,i.editedContent),r=O(t);let p="";for await(const j of r)p+=j;const k=window.prompt("Confirm or edit commit message:",p);if(!k){c(null);return}await M(s,o.owner,o.repo,[{path:i.path,content:i.editedContent}],k),y(`Successfully committed to ${o.repo}`,"success"),b(j=>j?{...j,originalContent:j.editedContent}:null)}catch(t){f(t)}finally{c(null)}}};if(!u)return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-text-secondary p-4",children:[e.jsx(g,{}),e.jsx("h2",{className:"text-lg font-semibold mt-2",children:"Please Sign In"}),e.jsx("p",{children:"Sign in to explore your repositories."})]});if(!n)return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-text-secondary p-4",children:[e.jsx(g,{}),e.jsx("h2",{className:"text-lg font-semibold mt-2",children:"Connect to GitHub"}),e.jsx("p",{children:'Please go to the "Connections" tab and provide a Personal Access Token to explore your repositories.'})]});const P=i?i.originalContent!==i.editedContent:!1;return e.jsxs("div",{className:"h-full flex flex-col text-text-primary",children:[e.jsxs("header",{className:"p-4 border-b border-border flex-shrink-0",children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center",children:[e.jsx(g,{}),e.jsx("span",{className:"ml-3",children:"Project Explorer"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{value:o?.full_name??"",onChange:t=>{const r=v.find(p=>p.full_name===t.target.value);r&&d({type:"SET_SELECTED_REPO",payload:{owner:r.owner.login,repo:r.name,full_name:r.full_name,name:r.name}})},className:"w-full p-2 bg-surface border border-border rounded-md text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:x==="repos"?"Loading...":"Select a repository"}),v.map(t=>e.jsx("option",{value:t.full_name,children:t.full_name},t.id))]})}),E&&e.jsx("p",{className:"text-red-500 text-xs mt-2",children:E})]}),e.jsxs("div",{className:"flex-grow flex min-h-0",children:[e.jsxs("aside",{className:"w-1/3 bg-background border-r border-border p-4 overflow-y-auto",children:[x==="tree"&&e.jsx("div",{className:"flex justify-center",children:e.jsx(C,{})}),l&&e.jsx(_,{node:l,onFileSelect:R,activePath:i?.path??null})]}),e.jsxs("main",{className:"flex-1 bg-surface flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 border-b border-border bg-gray-50 dark:bg-slate-800",children:[e.jsx("span",{className:"text-sm font-semibold",children:i?.name||"No file selected"}),e.jsx("button",{onClick:F,disabled:!P||x==="commit",className:"btn-primary px-4 py-1 text-sm flex items-center justify-center min-w-[100px]",children:x==="commit"?e.jsx(C,{}):"Commit"})]}),x==="file"?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(C,{})}):e.jsx("textarea",{value:i?.editedContent??"Select a file to view its content.",onChange:t=>b(r=>r?{...r,editedContent:t.target.value}:null),disabled:!i,className:"w-full h-full p-4 text-sm font-mono bg-transparent resize-none focus:outline-none"})]})]})]})};export{ct as ProjectExplorer};
//# sourceMappingURL=ProjectExplorer-v_HKOjED.js.map

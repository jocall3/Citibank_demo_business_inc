// Copyright James Burvel Oâ€™Callaghan III
// President Citibank Demo Business Inc.

{"version":3,"file":"AiFeatureBuilder-DF5vuSXc.js","sources":["../../components/features/AiFeatureBuilder.tsx"],"sourcesContent":["import React, { useState, useCallback, useEffect } from 'react';\nimport type { GeneratedFile } from '../../types.ts';\nimport { generateFeature, generateFullStackFeature, generateUnitTestsStream, generateCommitMessageStream, generateDockerfile } from '../../services/aiService.ts';\nimport { saveFile, getAllFiles, clearAllFiles } from '../../services/dbService.ts';\nimport { useNotification } from '../../contexts/NotificationContext.tsx';\nimport { CpuChipIcon, DocumentTextIcon, BeakerIcon, GitBranchIcon, CloudIcon } from '../icons.tsx';\nimport { LoadingSpinner, MarkdownRenderer } from '../shared/index.tsx';\n\ntype SupplementalTab = 'TESTS' | 'COMMIT' | 'DEPLOYMENT' | 'CODE';\ntype OutputTab = GeneratedFile | SupplementalTab;\n\nexport const AiFeatureBuilder: React.FC = () => {\n    const [prompt, setPrompt] = useState<string>('A simple \"Hello World\" React component with a button that shows an alert.');\n    const [framework] = useState('React');\n    const [styling] = useState('Tailwind CSS');\n    const [includeBackend, setIncludeBackend] = useState(false);\n\n    const [generatedFiles, setGeneratedFiles] = useState<GeneratedFile[]>([]);\n    const [unitTests, setUnitTests] = useState<string>('');\n    const [commitMessage, setCommitMessage] = useState<string>('');\n    const [dockerfile, setDockerfile] = useState<string>('');\n\n    const [activeTab, setActiveTab] = useState<OutputTab>('CODE');\n    const [isLoading, setIsLoading] = useState<boolean>(false);\n    const [error, setError] = useState<string>('');\n    \n    useEffect(() => {\n        const loadFiles = async () => {\n            const files = await getAllFiles();\n            setGeneratedFiles(files);\n            if (files.length > 0) setActiveTab(files[0]);\n        };\n        loadFiles();\n    }, []);\n\n    const handleGenerate = useCallback(async () => {\n        if (!prompt.trim()) { setError('Please enter a feature description.'); return; }\n        setIsLoading(true);\n        setError('');\n        await clearAllFiles();\n        setGeneratedFiles([]); setUnitTests(''); setCommitMessage(''); setDockerfile(''); setActiveTab('CODE');\n\n        try {\n            const resultFiles = includeBackend\n                ? await generateFullStackFeature(prompt, framework, styling)\n                : await generateFeature(prompt, framework, styling);\n            \n            for (const file of resultFiles) { await saveFile(file); }\n            setGeneratedFiles(resultFiles);\n\n            if (resultFiles.length > 0) {\n                const componentFile = resultFiles.find(f => f.filePath.endsWith('.tsx') || f.filePath.endsWith('.jsx'));\n                setActiveTab(componentFile || resultFiles[0]);\n\n                const testStream = generateUnitTestsStream(componentFile?.content || resultFiles[0].content);\n                const diffContext = resultFiles.map(f => `File: ${f.filePath}\\n\\n${f.content}`).join('\\n---\\n');\n                const commitStream = generateCommitMessageStream(diffContext);\n                \n                let tests = ''; for await (const chunk of testStream) { tests += chunk; setUnitTests(tests); }\n                let commit = ''; for await (const chunk of commitStream) { commit += chunk; setCommitMessage(commit); }\n                \n                if (!includeBackend) {\n                    const dockerfileStream = generateDockerfile(framework);\n                    let docker = ''; for await (const chunk of dockerfileStream) { docker += chunk; setDockerfile(docker); }\n                }\n            }\n        } catch (err) {\n            setError(err instanceof Error ? err.message : 'Failed to generate feature.');\n        } finally {\n            setIsLoading(false);\n        }\n    }, [prompt, framework, styling, includeBackend]);\n    \n    const renderContent = () => {\n        if (typeof activeTab === 'string') {\n            switch (activeTab) {\n                case 'TESTS': return <MarkdownRenderer content={unitTests} />;\n                case 'COMMIT': return <pre className=\"w-full h-full p-4 whitespace-pre-wrap font-sans text-sm\">{commitMessage}</pre>;\n                case 'DEPLOYMENT': return <MarkdownRenderer content={dockerfile} />;\n                default: return <div className=\"p-4\">Select a file</div>;\n            }\n        }\n        return <MarkdownRenderer content={'```tsx\\n' + activeTab.content + '\\n```'} />;\n    }\n\n    return (\n        <div className=\"h-full flex flex-col text-text-primary bg-surface\">\n            <header className=\"p-4 border-b border-border flex-shrink-0\">\n                <h1 className=\"text-xl font-bold flex items-center\"><CpuChipIcon /><span className=\"ml-3\">AI Feature Builder</span></h1>\n            </header>\n            <div className=\"flex-grow flex min-h-0\">\n                <main className=\"flex-1 flex flex-col min-w-0\">\n                    <div className=\"flex-grow flex flex-col bg-background\">\n                         <div className=\"border-b border-border flex items-center bg-surface overflow-x-auto\">\n                            {generatedFiles.map(file => (\n                                <button key={file.filePath} onClick={() => setActiveTab(file)} className={`flex-shrink-0 flex items-center gap-2 px-4 py-2 text-sm ${activeTab === file ? 'bg-background border-b-2 border-primary text-text-primary' : 'text-text-secondary hover:bg-gray-50'}`}><DocumentTextIcon /> {file.filePath}</button>\n                            ))}\n                            {unitTests && <button onClick={() => setActiveTab('TESTS')} className={`flex-shrink-0 flex items-center gap-2 px-4 py-2 text-sm ${activeTab === 'TESTS' ? 'bg-background border-b-2 border-primary text-text-primary' : 'text-text-secondary hover:bg-gray-50'}`}><BeakerIcon /> Tests</button>}\n                            {commitMessage && <button onClick={() => setActiveTab('COMMIT')} className={`flex-shrink-0 flex items-center gap-2 px-4 py-2 text-sm ${activeTab === 'COMMIT' ? 'bg-background border-b-2 border-primary text-text-primary' : 'text-text-secondary hover:bg-gray-50'}`}><GitBranchIcon /> Commit</button>}\n                            {dockerfile && !includeBackend && <button onClick={() => setActiveTab('DEPLOYMENT')} className={`flex-shrink-0 flex items-center gap-2 px-4 py-2 text-sm ${activeTab === 'DEPLOYMENT' ? 'bg-background border-b-2 border-primary text-text-primary' : 'text-text-secondary hover:bg-gray-50'}`}><CloudIcon /> Dockerfile</button>}\n                        </div>\n                        <div className=\"flex-grow p-2 overflow-auto\">\n                            {isLoading && !generatedFiles.length ? <div className=\"flex justify-center items-center h-full\"><LoadingSpinner/></div> : renderContent()}\n                        </div>\n                    </div>\n                    \n                    <div className=\"flex-shrink-0 p-4 border-t border-border bg-surface\">\n                         <div className=\"flex items-center gap-2 mb-2\">\n                            <label className=\"flex items-center gap-2 text-sm\"><input type=\"checkbox\" checked={includeBackend} onChange={e => setIncludeBackend(e.target.checked)} /> Include Backend (Cloud Function + Firestore)</label>\n                        </div>\n                        <textarea value={prompt} onChange={(e) => setPrompt(e.target.value)} placeholder=\"e.g., A user profile card with an avatar, name, and bio.\" className=\"w-full p-2 bg-background border border-border rounded-md resize-none text-sm h-20\"/>\n                         <div className=\"flex gap-2 mt-2\">\n                             <button onClick={handleGenerate} disabled={isLoading} className=\"btn-primary flex-grow flex items-center justify-center gap-2 px-4 py-2\">\n                                {isLoading ? <><LoadingSpinner /> Generating...</> : 'Generate Feature'}\n                            </button>\n                         </div>\n                         {error && <p className=\"text-red-600 text-xs mt-2 text-center\">{error}</p>}\n                    </div>\n                </main>\n            </div>\n        </div>\n    );\n};\n"],"names":["AiFeatureBuilder","prompt","setPrompt","useState","framework","styling","includeBackend","setIncludeBackend","generatedFiles","setGeneratedFiles","unitTests","setUnitTests","commitMessage","setCommitMessage","dockerfile","setDockerfile","activeTab","setActiveTab","isLoading","setIsLoading","error","setError","useEffect","files","getAllFiles","handleGenerate","useCallback","clearAllFiles","resultFiles","generateFullStackFeature","generateFeature","file","saveFile","componentFile","f","testStream","generateUnitTestsStream","diffContext","commitStream","generateCommitMessageStream","tests","chunk","commit","dockerfileStream","generateDockerfile","docker","err","renderContent","jsx","MarkdownRenderer","jsxs","CpuChipIcon","DocumentTextIcon","BeakerIcon","GitBranchIcon","CloudIcon","LoadingSpinner","e","Fragment"],"mappings":"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"}